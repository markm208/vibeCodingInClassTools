<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LLM Temperature Visualization</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #f3f4f6;
      min-height: 100vh;
      padding: 24px;
    }
    
    .container {
      max-width: 640px;
      margin: 0 auto;
    }
    
    h2 {
      font-size: 1.25rem;
      font-weight: bold;
      color: #1f2937;
      margin-bottom: 8px;
    }
    
    .input-text {
      color: #4b5563;
      margin-bottom: 16px;
    }
    
    .card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      padding: 16px;
      margin-bottom: 24px;
    }
    
    .slider-label {
      font-size: 0.875rem;
      font-weight: 500;
      color: #374151;
      margin-bottom: 8px;
    }
    
    .slider {
      width: 100%;
      height: 8px;
      border-radius: 4px;
      appearance: none;
      background: #e5e7eb;
      cursor: pointer;
    }
    
    .slider::-webkit-slider-thumb {
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #3b82f6;
      cursor: pointer;
    }
    
    .slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #3b82f6;
      cursor: pointer;
      border: none;
    }
    
    .slider-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 4px;
    }
    
    .chart-title {
      font-size: 0.875rem;
      font-weight: 500;
      color: #374151;
      margin-bottom: 16px;
    }
    
    .bar-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }
    
    .word-label {
      width: 96px;
      text-align: right;
      font-size: 0.875rem;
      font-family: monospace;
      color: #374151;
    }
    
    .bar-container {
      flex: 1;
      height: 24px;
      background: #f3f4f6;
      border-radius: 4px;
      overflow: hidden;
    }
    
    .bar {
      height: 100%;
      border-radius: 4px;
      transition: width 0.3s ease;
    }
    
    .bar.primary {
      background: #3b82f6;
    }
    
    .bar.secondary {
      background: #93c5fd;
    }
    
    .prob-label {
      width: 64px;
      font-size: 0.875rem;
      color: #4b5563;
    }
    
    .info-box {
      margin-top: 16px;
      padding: 16px;
      background: #eff6ff;
      border-radius: 8px;
    }
    
    .info-box p {
      font-size: 0.875rem;
      color: #374151;
    }
    
    .info-box strong {
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Next Token Prediction</h2>
    <p class="input-text">Input: "I have a dog that runs ___"</p>
    
    <div class="card">
      <div class="slider-label">Temperature: <span id="temp-value">1.0</span></div>
      <input 
        type="range" 
        id="temperature" 
        class="slider" 
        min="0" 
        max="2" 
        step="0.1" 
        value="1.0"
      >
      <div class="slider-labels">
        <span>0 (greedy)</span>
        <span>1.0 (neutral)</span>
        <span>2.0 (creative)</span>
      </div>
    </div>
    
    <div class="card">
      <h3 class="chart-title">Probability Distribution</h3>
      <div id="chart"></div>
    </div>
    
    <div class="info-box">
      <p id="explanation"></p>
    </div>
  </div>

  <script>
    const baseWords = [
      { word: 'fast', baseProb: 0.28 },
      { word: 'quickly', baseProb: 0.19 },
      { word: 'away', baseProb: 0.14 },
      { word: 'daily', baseProb: 0.11 },
      { word: 'outside', baseProb: 0.08 },
      { word: 'everywhere', baseProb: 0.07 },
      { word: 'wild', baseProb: 0.05 },
      { word: 'free', baseProb: 0.04 },
      { word: 'marathons', baseProb: 0.025 },
      { word: 'circles', baseProb: 0.015 },
    ];

    function calculateProbabilities(temperature) {
      if (temperature === 0) {
        return baseWords.map((w, i) => ({
          ...w,
          prob: i === 0 ? 1.0 : 0.0
        }));
      }
      
      const logits = baseWords.map(w => Math.log(w.baseProb));
      const scaledLogits = logits.map(l => l / temperature);
      const maxLogit = Math.max(...scaledLogits);
      const expScaled = scaledLogits.map(l => Math.exp(l - maxLogit));
      const sumExp = expScaled.reduce((a, b) => a + b, 0);
      
      return baseWords.map((w, i) => ({
        ...w,
        prob: expScaled[i] / sumExp
      }));
    }

    function getExplanation(temperature) {
      if (temperature === 0) {
        return '<strong>Temperature 0:</strong> Always picks "fast". Deterministic but repetitive.';
      } else if (temperature < 0.5) {
        return '<strong>Low temperature:</strong> Strongly favors high-probability words. More predictable output.';
      } else if (temperature <= 1.2) {
        return '<strong>Moderate temperature:</strong> Balanced distribution. Natural-sounding variety.';
      } else {
        return '<strong>High temperature:</strong> Flattened distribution. More creative but possibly incoherent.';
      }
    }

    function renderChart(temperature) {
      const words = calculateProbabilities(temperature);
      const maxProb = Math.max(...words.map(w => w.prob));
      
      const chartHtml = words.map((item, index) => `
        <div class="bar-row">
          <div class="word-label">${item.word}</div>
          <div class="bar-container">
            <div 
              class="bar ${index === 0 ? 'primary' : 'secondary'}"
              style="width: ${(item.prob / maxProb) * 100}%"
            ></div>
          </div>
          <div class="prob-label">${(item.prob * 100).toFixed(1)}%</div>
        </div>
      `).join('');
      
      document.getElementById('chart').innerHTML = chartHtml;
      document.getElementById('explanation').innerHTML = getExplanation(temperature);
    }

    const slider = document.getElementById('temperature');
    const tempValue = document.getElementById('temp-value');

    slider.addEventListener('input', function() {
      const temp = parseFloat(this.value);
      tempValue.textContent = temp.toFixed(1);
      renderChart(temp);
    });

    // Initial render
    renderChart(1.0);
  </script>
</body>
</html>
